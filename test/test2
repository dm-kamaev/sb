'use strict';
const async = require('asyncawait/async');
const await = require('asyncawait/await');
const util = require('util');

var Sequelize = require('sequelize');
var sequelize = new Sequelize('sber-together-api', 'postgres', '123qwe', {
    host: 'localhost',
    dialect: 'postgres'
})

var Entity = sequelize.define('Entity', {
    id: {
        allowNull: false,
        autoIncrement: true,
        primaryKey: true,
        type: Sequelize.INTEGER,
    },
    title: {
        type: Sequelize.STRING
    },
    description: {
        type: Sequelize.TEXT
    }
}, {
    tableName: 'entity',
    unserscored: true,
    classMethods: {
        associate: function(models) {
            Entity.belongsToMany(Entity, {
                as: 'trend',
                through: 'entities_assosciations'
            });
            Entity.belongsToMany(Entity, {
                as: 'category',
                through: 'entities_assosciations'
            });
            Entity.belongsToMany(Entity, {
                as: 'funds',
                through: 'entities_assosciations'
            });
            Entity.hasMany(models.UserFund, {
                as: 'user_fund_id'
            })
        }
    }
})
var Proj = sequelize.define('Project', {
  name: Sequelize.STRING
})
Entity.belongsToMany(Entity, {
    as: 'Category',
    through: 'trends_assosciations'
});

Entity.belongsToMany(Proj, {
  through: 'aaa'
});
Proj.belongsToMany(Entity, {
  through: 'aaa'
});
// Entity.belongsToMany(Entity, {
//     through: 'category_assosciations'
// });
// Entity.belongsToMany(Entity, {
//     through: 'funds_assosciations'
// });
// Entity.hasMany(models.UserFund, {
//   as: 'user_fund_id'
// })

(async(function() {
    await (sequelize.sync({force: true}))
    var entity1 = await (Entity.findOrCreate({
        where: {
            title: '1111',
            description: 'desc222'
        }
    }))
    var entity2 = await (Entity.findOrCreate({
        where: {
            title: '2222',
            description: 'desc444'
        }
    }));
    var proj = await(Proj.findOrCreate({
      where: {
        name: '111'
      }
    }))
    entity1.addProject(entity1)
    // entity1.sTrend(entity2)
    // console.log(util.inspect(asociation, { showHidden: true, depth: null }))
    // console.log(util.inspect(entity1, { showHidden: true, depth: 3 }))
    // Entity.addCategory(entity2);
}))();
